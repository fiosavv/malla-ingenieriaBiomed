const ramos = {
  "Cálculo I": { requisitos: [], semestre: 1, desbloquea: ["Cálculo II", "Fundamentos de economía para ingeniería"] },
  "Álgebra I": { requisitos: [], semestre: 1, desbloquea: ["Álgebra II"] },
  const estado = {};
const mallaDiv = document.querySelector(".malla");

Object.entries(ramos).forEach(([nombre, data]) => {
  const div = document.createElement("div");
  div.className = "ramo bloqueado";
  div.textContent = nombre;
  div.dataset.nombre = nombre;

  const columna = document.getElementById(`semestre-${data.semestre}`);
  columna.appendChild(div);

  estado[nombre] = {
    aprobado: false,
    div: div,
    desbloqueado: data.requisitos.length === 0
  };

  if (estado[nombre].desbloqueado) {
    desbloquear(nombre);
  }
});

function desbloquear(nombre) {
  const ramo = estado[nombre];
  if (!ramo.aprobado && !ramo.div.classList.contains("desbloqueado")) {
    ramo.div.classList.remove("bloqueado");
    ramo.div.classList.add("desbloqueado");
    ramo.div.addEventListener("click", () => aprobar(nombre));
  }
}

function aprobar(nombre) {
  const ramo = estado[nombre];
  if (!ramo.aprobado) {
    ramo.aprobado = true;
    ramo.div.classList.add("aprobado");
    ramo.div.classList.remove("desbloqueado");
    const desbloquea = ramos[nombre].desbloquea || [];
    desbloquea.forEach(dest => {
      const requisitos = ramos[dest].requisitos || [];
      const aprobados = requisitos.every(req => estado[req]?.aprobado);
      if (aprobados) desbloquear(dest);
    });
  }
}
